{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="profile-section">
    <div class="profile-card">
        <div class="profile-header">
            {% comment %} <img src="{% static 'img/default-avatar.png' %}" alt="Profile Icon" class="profile-icon"> {% endcomment %}
            <h2 class="profile-username">{{ user.username }}</h2>
            <p class="profile-joined">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è: {{ user.date_joined|date:"F Y" }}</p>
        </div>
        <form class="profile-form" method="post" id="profile-form">
            {% csrf_token %}
            <div class="form-group profile-group">
                <label for="first_name" class="profile-label">–ò–º—è</label>
                <input type="text" name="first_name" id="first_name" value="{{ user.first_name }}" class="form-input profile-input" required>
            </div>
            <div class="form-group profile-group">
                <label for="last_name" class="profile-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" name="last_name" id="last_name" value="{{ user.last_name }}" class="form-input profile-input" required>
            </div>
            <div class="form-group profile-group">
                <label for="password" class="profile-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <div style="position: relative;">
                    <input type="password" name="password" id="password" class="form-input profile-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" style="padding-right: 40px;">
                    <span id="toggle-password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">
                        üëÅÔ∏è
                    </span>
                </div>
                <div class="password-requirements">
                    –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, –º–∏–Ω–∏–º—É–º 1 –∑–∞–≥–ª–∞–≤–Ω—É—é –±—É–∫–≤—É –∏ 1 —Ü–∏—Ñ—Ä—É.
                </div>
                <div class="messages error password-error" id="password-error" style="display: none;"></div>
            </div>
            <button type="submit" class="submit profile-submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
        <a href="{% url 'logout' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
    </div>
</section>
{% endblock %}

{% block footer %}
    <!-- –û—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã —Ñ—É—Ç–µ—Ä –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è -->
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('profile-form').addEventListener('submit', function(event) {
        const password = document.getElementById('password').value;
        const passwordError = document.getElementById('password-error');

        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è –ø—É—Å—Ç–æ–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é (–ø–∞—Ä–æ–ª—å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)
        if (!password) {
            passwordError.style.display = 'none';
            return;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–∞—Ä–æ–ª—é
        const minLength = password.length >= 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        const isLatin = /^[A-Za-z0-9]*$/.test(password); // –¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã

        if (!minLength || !hasUpperCase || !hasNumber || !isLatin) {
            event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
            let errorMessage = '–ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: ';
            if (!minLength) errorMessage += '–º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤; ';
            if (!hasUpperCase) errorMessage += '–Ω–µ—Ç –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã; ';
            if (!hasNumber) errorMessage += '–Ω–µ—Ç —Ü–∏—Ñ—Ä—ã; ';
            if (!isLatin) errorMessage += '–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã; ';
            passwordError.textContent = errorMessage;
            passwordError.style.display = 'block';
        } else {
            passwordError.style.display = 'none';
        }
    });

    document.getElementById('toggle-password').addEventListener('click', function () {
        const passwordInput = document.getElementById('password');
        const type = passwordInput.getAttribute('type');
        passwordInput.setAttribute('type', type === 'password' ? 'text' : 'password');
        this.textContent = type === 'password' ? 'üôà' : 'üëÅÔ∏è';
    });
</script>
    <script src="{% static 'js/script.js' %}"></script>
{% endblock %}

